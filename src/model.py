# src/model.py
import math

class DiabetesAI:
    def __init__(self):
        # ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå .pkl ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ
        # self.model = pickle.load(open('model/diabetes_model.pkl', 'rb'))
        pass

    def predict_risk(self, data):
        """
        Input: data (Object) contains weight, height, waist, glucose, age
        Output: dict with risk_level, message, action_type
        """
        # 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô
        height_m = data.height / 100
        if height_m == 0: height_m = 1.7
        
        bmi = round(data.weight / (height_m ** 2), 2)
        wthr = round(data.waist / data.height, 2)
        
        # 2. Strategic Logic (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö)
        risk_score = 0
        action_type = "low"
        message = ""

        # ‡∏Å‡∏£‡∏ì‡∏µ: ‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• (Glucose = 0)
        # AI ‡∏à‡∏∞‡πÉ‡∏ä‡πâ BMI ‡πÅ‡∏•‡∏∞ WtHR ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏ó‡∏ô
        if data.glucose == 0:
            if bmi > 25 or wthr > 0.55:
                # ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á -> ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î
                risk_score = 80
                action_type = "urgent_test"
                message = f"‚ö†Ô∏è <b>‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á (BMI {bmi}):</b><br>AI ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ<b>‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏õ‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß (POCT)</b> ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"
            elif bmi > 23 or wthr > 0.5:
                risk_score = 45
                action_type = "medium"
                message = f"üü° <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á:</b><br>‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡πâ‡∏ß‡∏° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏∏‡∏°‡πÅ‡∏õ‡πâ‡∏á/‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£"
            else:
                risk_score = 15
                action_type = "low"
                message = f"üü¢ <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥:</b><br>‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏™‡∏°‡∏™‡πà‡∏ß‡∏ô ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ"
        
        # ‡∏Å‡∏£‡∏ì‡∏µ: ‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏•‡πâ‡∏ß
        else:
            if data.glucose >= 126:
                risk_score = 95
                action_type = "high"
                message = f"üî¥ <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á (High Risk):</b><br>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• {data.glucose} ‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå"
            elif data.glucose >= 100:
                risk_score = 60
                action_type = "medium"
                message = f"üü† <b>‡∏†‡∏≤‡∏ß‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô (Pre-Diabetes):</b><br>‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á"
            else:
                risk_score = 10
                action_type = "low"
                message = f"üü¢ <b>‡∏ú‡∏•‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏õ‡∏Å‡∏ï‡∏¥:</b><br>‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ï‡πà‡∏≠‡πÑ‡∏õ"

        return {
            "bmi": bmi,
            "wthr": wthr,
            "risk_score": risk_score,
            "action_type": action_type, # ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ UI
            "message": message
        }